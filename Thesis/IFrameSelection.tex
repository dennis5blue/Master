\section{Proposed I-frame selection Algorithm}
\label{sec::IFrameSelection}
%\begin{figure*}
\begin{figure}
\begin{center}
\includegraphics[width=0.95\columnwidth]{Figures/BBdesignIframeSelection.pdf}
\caption{\label{fig::BBdesgin}Enumeration tree of branch-and-bound algorithm}
\end{center}
\end{figure}
%\end{figure*}
%
\begin{figure}
\begin{center}
\includegraphics[width=0.95\columnwidth]{Figures/referenceStructure.pdf}
\caption{\label{fig::encodeOrder}Coding structure of a group of pictures}
\end{center}
\end{figure}
As we mentioned before, problem~\eqref{eq::formulation} is a $\mathcal{NP}$-hard problem, therefore, we show how to simplify and solve this problem in this chapter.
Note that we assume a P-frame can only reference from one I-frame as equation~\eqref{eq::referenceOnlyIframe} shows.
According to equation~\eqref{eq::referenceOnlyIframe}, the coding structure of a group of pictures can be shown in figure~\ref{fig::encodeOrder}, where every P-frames will reference from the closest previous I-frame to reduce its encoded bits.
Consequently, problem~\eqref{eq::formulation} can be decomposed into two sub-problems, including (a) the I-frame selection sub-problem and (b) the P-frame scheduling sub-problem.
We will show how the I-frame selection sub-problem is solved in this chapter.
%, where the proposed algorithm for P-frame scheduling is presented in chapter~\ref{sec::PFrameScheduling}.

\subsection{I-frame Selection Sub-Problem}
\label{sec::iFrameSelectionSubProb}
Note that the decision variables of the I-frame selection sub-problem are the diagonal elements of $\mathbf{X}$.
We aim to figure out whether ${x_{ii},i \in V}$ equals to $0$ or $1$ so that the total amount of encoded bits can be minimized, where the other scheduling constraints are ignore during the selection of I-frames.
Suppose that camera $i$ is encoded as an I-frame, it is clearly that it requires $H(F_i)$ to encode its image.
However, if camera $i$ is encoded as a P-frame, the amount of encoded bits should depend on which I-frame it references from.
An intuitive method to determine the reference frame is to select the most correlated I-frame, and the amount of encoded bits can be written as $\underset{j \in U_i, x_{jj}=1}{\min} H(F_i|F_j)$.
Therefore, the I-frame selection sub-problem can be written as
\begin{equation*}
\min \left(
\sum_{i=1}^{|V|} x_{ii}H(F_i) +
\sum_{i=1}^{|V|} (1-x_{ii}) \underset{j \in D_i}{\min} H(F_i|F_j) \right),
\end{equation*}
subject to
\begin{align}
&U_i = \{ j \in V | d_{ij} \leq \rho d_{j0} \}, &\forall i \in V, \nonumber \\
&D_i = \{ j \in U_i| x_{jj} = 1\}, &\forall i \in V, \nonumber \\
&x_{ii} = \{0,1\}, &\forall i \in V.
\label{eq::IframeSelectionSubProblem}
\end{align}

Since all the decision variables ${x_{ii},i \in V}$ belong to a binary integer, it is clearly that the optimal solution can be found if we search through the feasible set.
However, directly traversing the whole set would lead to very high computational complexity, and hence some policy must be included for reducing the complexity.
One possible method without losing the optimality is through the branch-and-bound (BB) algorithm~\cite{BB} as presented in the followings.
Another algorithm to solve problem~\eqref{eq::IframeSelectionSubProblem} in a more time efficient way is to model~\eqref{eq::IframeSelectionSubProblem} into a graph problem, which will also be described in this chapter.
%
\subsection{Branch-and-Bound Selection Algorithm}
%{\color{red}Describe the proposed branch-and-bound algorithm for I-frame selection}
Note that the solution set of problem~\eqref{eq::IframeSelectionSubProblem} can be modeled as an enumeration tree as shown in figure~\ref{fig::BBdesgin}, where the root of the enumeration tree is denoted as the whole solution set $\mathcal{S}$.
The main idea of the BB algorithm is to divide the solution set $\mathcal{S}$ into smaller subsets $\mathcal{S}^1, \mathcal{S}^2, \cdots$ and if one subset has no possibility to include the optimal solution, then it is not required to be divided any more.
Therefore, a proper policy to ``branch'' and ``bound'' must be well designed for the efficiency of the BB algorithm, and we introduce the ``branching'' and ``bounding'' policy in the followings.
%
\subsubsection{Bounding Policy}
Before introducing the bounding policy, we first propose an algorithm to estimate the lower bound of total cost of each sub solution set $\mathcal{S}^t$.
If the cost lower bound of a sub solution set $lb(\mathcal{S}^t)$ is greater than the upper bound of objective value, the sub solution set $\mathcal{S}^t$ is no longer necessary to be divided since it has no possibility to contain the optimal solution.
Therefore, the time complexity of the BB algorithm is highly correlated to the difference between estimated lower bound and actual lower bound.
For this reason, a smart algorithm is thus necessary to be designed for finding a tighter lower bound.
To start, we denote the cost matrix for the I-frame selection sub-problem as:
\begin{align}
\mathbf{H}
&= \left[ \mathbf{h}_1 \quad \mathbf{h}_2 \quad \cdots \quad \mathbf{h}_{|V|} \right], \nonumber \\
&= \left[ \begin{array}{cccc}
h_{11} &h_{12} &\cdots &h_{1|V|} \\
h_{21} &h_{22} &\cdots &h_{2|V|} \\
\vdots &\vdots &\vdots &\vdots \\
h_{|V|1} &h_{|V|2} &\cdots &h_{|V||V|}
\end{array} \right],
\label{eq::bbCostMatrix}
\end{align}
where $\mathbf{h}_k$ is the $k^{th}$ column of $\mathbf{H}$ and ${h_{ij} = H(F_i|F_j)}$ if ${i \neq j}$ and ${h_{ii}=H(F_i|F_i)=H(F_i)}$.
The cost matrix in~\eqref{eq::bbCostMatrix} will be calculated as a beforehand information so that the lower bound of cost below a branch can be estimated directly through $\mathbf{H}$.

For an arbitrary sub solution set $\mathcal{S}^t$, some decision variables are fixed to either $0$ or $1$ while the others are still undetermined.
We thus denote the partial determined selection vector ${\tilde{\mathbf{X}^t} = \{ \tilde{x_{11}^t},\cdots, \tilde{x_{|V||V|}^t} \} }$ such that
\begin{equation*}
\left\{ \begin{array}{ll}
\tilde{x_{ii}^t} = 1,  &\text{ if camera $i$ is determined to encode as an} \\
                   	   &\text{ I-frame for $\mathcal{S}^t$ and all its sub solution set,} \\
\tilde{x_{ii}^t} = 0,  &\text{ if camera $i$ is determined to encode as a} \\
                   	   &\text{ P-frame for $\mathcal{S}^t$ and all its sub solution set,} \\
\tilde{x_{ii}^t} = -1, &\text{ if the camera $i$'s encoding style is not decided} \\
                       &\text{ until the division of sub solution set $\mathcal{S}^t$.}
\end{array} \right.
\end{equation*}
%
According to $\tilde{\mathbf{X}^t}$, we can further define the determined I-frame set of $\mathcal{S}^t$ as $\mathcal{I}^t$:
\begin{equation}
\mathcal{I}^t = \{ i \in V | \tilde{x_{ii}^t} = 1 \},
\label{eq::IframeSet}
\end{equation}
and the determined P-frame set can also be written as:
\begin{equation}
\mathcal{P}^t = \{ i \in V | \tilde{x_{ii}^t} = 0 \},
\label{eq::PframeSet}
\end{equation}
where the set of undetermined encoded style cameras at $\mathcal{S}^t$ is $V \setminus \{ \mathcal{I}^t \cup \mathcal{P}^t \}$.

For camera $i \in \mathcal{I}^t$, it is clearly that the amount of bits required to encoded $F_i$ equals $H(F_i)$.
On the other hand, if $k \in V \setminus \mathcal{I}^t$, camera $k$ has the possibility to encode its image as a P-frame.
As a consequence, the amount of bits required to encode $F_k$ must be less than or equal to $H(F_k)$.
Since our goal is to find the \emph{lower bound} of required encoded bits, we can thus relaxed the constraints of P-frame reference from an I-frame so that the obtained result will become a weak lower bound.
That is, the cost of P-frame $\underset{j \in D_k}{\min} H(F_k|F_j)$ now becomes $\underset{j \in U_k}{\min} H(F_k|F_j)$.
However, we also note that according to constraint~\eqref{eq::referenceOnlyIframe}, a P-frame cannot become a reference frame of camera $k$, which means that the lower bound $\underset{j \in U_k}{\min} H(F_k|F_j)$ is still too optimistic.
Therefore, a tighter lower bound of camera $k$'s encoding cost should be $\underset{j \in U_k, j \notin \mathcal{P}^t}{\min} H(F_k|F_j)$.
%

Besides, also note that if camera $i$ reference from camera $j$, then camera $j$ cannot reference from camera $i$.
As a consequence, either camera $i$ or $j$ should change its reference camera so that the solution can be feasible.
Since our goal is to find the lower bound of encoding cost, which one to change the reference camera depends on the incremental cost for changing the reference camera, where the incremental cost of camera $i$ and $j$ can be written as:
\begin{align}
\Delta_i &= \left( \underset{k \in U_i, k \notin \{\mathcal{P}^t \cup j\}}{\min} H(F_i|F_k) \right) - H(F_i|F_j), \nonumber \\
\Delta_j &= \left( \underset{k \in U_j, k \notin \{\mathcal{P}^t \cup i\}}{\min} H(F_j|F_k) \right) - H(F_j|F_i).
\end{align}
Based on the incremental cost $\Delta_i$ and $\Delta_j$, we can define a selection function for determining which camera should change its reference as:
\begin{equation}
Q(i,j) = 
\left\{ \begin{array}{ll}
i,  &\text{ if $\Delta_i \leq \Delta_j$,} \\                  	   
j,  &\text{ if $\Delta_i > \Delta_j$,} \\
\end{array} \right.
\label{eq::selectionFunctionQ}
\end{equation}
where $Q(i,j) = i$ means that the reference camera of camera $i$ is changed from camera $j$ to camera $\underset{k \in U_i, k \notin \{\mathcal{P}^t \cup\{j\}\}}{\arg \min} H(F_i|F_k)$ due to the reason that changing camera $i$'s reference camera has lower cost.

To start the lower bound estimation algorithm for sub solution set $\mathcal{S}^t$, we first initialize its cost matrix as
\begin{align}
\mathbf{H}^t
&= \left[ \mathbf{h}_1^t \quad \mathbf{h}_2^t \quad \cdots \quad \mathbf{h}_{|V|}^t \right], \nonumber \\
&= \left[ \begin{array}{cccc}
h_{11}^t &h_{12}^t &\cdots &h_{1|V|}^t \\
h_{21}^t &h_{22}^t &\cdots &h_{2|V|}^t \\
\vdots &\vdots &\vdots &\vdots \\
h_{|V|1}^t &h_{|V|2}^t &\cdots &h_{|V||V|}^t
\end{array} \right]
= \mathbf{H},
\label{eq::modBBcostMatrix}
\end{align}
where the columns of P-frame cameras are set to infinity since we assume that P-frame cannot become a reference frame.
That is,
\begin{equation}
\mathbf{h}^t_i = \left[ \begin{array}{c}
\infty \\
\infty \\
\vdots \\
\infty
\end{array} \right],
\quad \quad \forall i \in \mathcal{P}^t.
\label{eq::infColumn}
\end{equation}
To proceed, we then define the reference vector ${\mathbf{R}^t = [r_1^t,r_2^t,\cdots,r_{|V|}^t]}$ such that $r_i^t = j$ if camera $i$ reference from camera $j$, where the elements of $\mathbf{R}^t$ can be initialized as:
\begin{equation}
r_i^t = 
\left\{ \begin{array}{cc}
i,  &\text{ if $i \in \mathcal{I}^t$,} \\                  	   
\underset{k \in U_i, k \notin \mathcal{P}^t}{\arg\min} H(F_i|F_k),  &\text{ if $i \in V\setminus \mathcal{I}^t$.} \\
\end{array} \right.
\label{eq::initRefStructure}
\end{equation}
After the initialization of $\mathbf{R}$, we will traverse through all elements of $\mathbf{R}$ and check if there exists infeasible reference structure pair (e.g. $r_i^t = j$ together with $r_j^t=i$).
In such infeasible case, we will refer to equation~\eqref{eq::selectionFunctionQ} for determining which one should change the reference camera until all reference structure pairs are feasible.
As long as all reference structure pairs are feasible, we can directly sum up the cost of all cameras and the estimated lower bound is obtained.
%
In short, the lower bound estimation procedure of an arbitrary sub solution set $\mathcal{S}^t$ is summarized in algorithm~\ref{alg::lbEstimation}.
%
\IncMargin{1em}
\begin{algorithm}[]
 \SetAlgoLined
 \SetKwInOut{Input}{Input}\SetKwInOut{Output}{Output}
 \Input{Partial determined selection vector $\tilde{\mathbf{X}^t}$ of $\mathcal{S}^t$ and cost matrix $\mathbf{H}$~\eqref{eq::bbCostMatrix}}
 \Output{Cost lower bound $lb(\mathcal{S}^t)$ among all sub solution set of $\mathcal{S}^t$}
 \BlankLine
 Initialize $lb(\mathcal{S}^t) \gets 0$\\
 Initialize $\mathcal{I}^t$ by~\eqref{eq::IframeSet}, $\mathcal{P}^t$ by~\eqref{eq::PframeSet}, $\mathbf{H}^t$ by~\eqref{eq::modBBcostMatrix}~\eqref{eq::infColumn} and $\mathbf{R}^t$ by~\eqref{eq::initRefStructure} \\
 \While{$\forall i \in V, \exists j \in V, j \neq i$ such that $r_i^t=j$ and $r_j^t=i$}
 {
 	$\Delta_i \gets \left( \underset{k \in U_i, k \notin \{\mathcal{P}^t \cup j\}}{\min} h_{ik}^t \right) - h_{ij}^t$ \\
	$\Delta_j \gets \left( \underset{k \in U_j, k \notin \{\mathcal{P}^t \cup i\}}{\min} h_{jk}^t \right) - h_{ji}^t$ \\
 	$k \gets Q(i,j)$ \\
 	$r_k^t \gets \underset{m \in U_i, m \notin \{\mathcal{P}^t \cup \{j\}\}}{\arg \min} h_{im}^t$ \\
 	\eIf{$k = i$}
 	{
 		$h_{ij}^t \gets \inf$ \\
 	}
 	{
 		$h_{ji}^t \gets \inf$ \\
 	}
 	
 }
 \For{$i \in V$}
 {
 	$lb(\mathcal{S}^t) \gets lb(\mathcal{S}^t) + \underset{j \in U_i}{\min} h_{ij}^t$ \\
 }
 \caption{\label{alg::lbEstimation}Proposed lower bound estimation method}
\end{algorithm}
\DecMargin{1em}
%
\subsubsection{Branching Policy}
After presenting the bounding policy of our proposed BB algorithm in the previous chapter, we introduce how we (a) divide the solution set $\mathcal{S}^t$ into subsets and (b) decide which subset to be traversed first.
To answer the first question, note that since the decision variables $x_{ii}$ belongs to binary integer (i.e. $0$ or $1$), it is thus clearly that the division of $\mathcal{S}^t$ includes two different subsets $\mathcal{S}^{t_0}$ and $\mathcal{S}^{t_1}$, where  $\mathcal{S}^{t_0}$ and $\mathcal{S}^{t_1}$ is created by fixing one decision variable ${x_{kk},k \in V \setminus \{\mathcal{I}^t \cup \mathcal{P}^t\} }$ into $0$ or $1$, respectively.

For the second question, although $k$ can be selected randomly from $ V \setminus \{\mathcal{I}^t \cup \mathcal{P}^t\}$, we claimed in this thesis that the priority of traversing $\mathcal{S}^{t_0}$ or $\mathcal{S}^{t_1}$ might affect the speed of convergence.
The reason why the decision of traversing $\mathcal{S}^{t_0}$ or $\mathcal{S}^{t_1}$ first is an important issue is that if two cameras $i$ and $j$ are high correlated with each other, it is intuitive that letting both $x_{ii}$ and $x_{jj}$ equal to $1$ is not a good choice.
%
Therefore, the sub solution set with $x_{ii}=1$ and $x_{jj}=1$ should have less priority to be traversed.
Due to this reason, we proposed a heuristic approach for the determination of which sub solution set has the highest priority to be traversed for the sake of getting the optimal solution within fewer iterations.
Our proposed branching metric for $\mathcal{S}^t$ is thus defined as:
\begin{equation}
\lambda_t = \frac{1}{|V|-|\mathcal{I}^t|-|\mathcal{P}^t|+1}+\frac{1}{lb(\mathcal{S}^t)},
\label{eq::branchingMetric}
\end{equation}
where the notation $|\cdot|$ returns the size of the set.
The idea of equation~\eqref{eq::branchingMetric} can be understood by the following two parts.
For a group of sub solution sets $\mathcal{S}^t, \mathcal{S}^{t+1}, \cdots$, we will select the one with
\begin{itemize}
\item more cameras have been determined to encode their images as I-frames or P-frames (i.e. the depth of enumeration tree), and
\item  lower estimated lower bound
\end{itemize}
to be traversed first.
Note that since $lb \gg |V|-|\mathcal{I}^t|-|\mathcal{P}^t|+1$, we will first check the depth of each sub solution sets, and if more than one sub solution sets have the same highest depth, and then the estimated lower bound will be taken into consideration; otherwise, $\frac{1}{|V|-|\mathcal{I}^t|-|\mathcal{P}^t|+1}$ will dominate the value of $\lambda_t$.
As a summary, among all un-traversed sub solution sets, our proposed branching policy algorithm will select the one with the largest branching metric $\lambda_t$ to be traversed first, and the overall BB algorithm is then described in the following chapter.
%

\subsubsection{Overall Algorithm}
\begin{figure}
\begin{center}
\includegraphics[width=0.95\columnwidth]{Figures/flowChartBB2.pdf}
\caption{\label{fig::flowChartBB}Flow chart of proposed BB algorithm}
\end{center}
\end{figure}
Based on the ideas described in the previous chapters, we can now present how the overall proposed BB algorithm works, where figure~\ref{fig::flowChartBB} shows the flow chart of our proposed algorithm.
For the setup of BB algorithm, we first define the whole solution set $\mathcal{S}$ as the combination of $x_{ii} = \{0,1\}, \forall i \in V$, and the initial minimum cost $ub(\mathcal{S}^*) = \infty$.
We then divide $\mathcal{S}$ into two sub solution sets by fixing an arbitrary $x_{ii}, i \in V$ to $0$ and $1$, where the two divided sub solution sets are inserted into a queue for containing sub solution sets.
Among all sub solution sets in queue, we refer to the branching metric~\eqref{eq::branchingMetric} for the determination of which one to be traversed first.
As long as the lower bound estimated from algorithm~\ref{alg::lbEstimation} is lower than the minimum cost obtained so far, we keep dividing this sub solution set; otherwise, no more division is required since the optimal solution has no possibility to be found in this sub solution set.
We now summarize the overall proposed BB algorithm in algorithm~\ref{alg::bbAlgorithm}.
\IncMargin{1em}
\begin{algorithm}[]
 \SetAlgoLined
 \SetKwInOut{Input}{Input}\SetKwInOut{Output}{Output}
 \Input{Whole solution set $\mathcal{S}$}
 \Output{Optimal I-frame cameras selection $\mathcal{S}^*$ and the minimum cost $ub(\mathcal{S}^*)$}
 \BlankLine
 Initialize $ub(\mathcal{S}^*) \gets \infty$ \\
 Initialize queue for containing sub solution sets $\Psi \gets \emptyset$ \\
 Randomly select $k$ from $V$ \\
 Fix $x_{kk} \gets 0$ and $x_{kk} \gets 1$ to form two sub solution sets of $\mathcal{S}$, say $\mathcal{S}^1$ and $\mathcal{S}^2$ \\
 Put the two sub solution sets into $\Psi$, i.e. $\Psi \gets \Psi \cup \{\mathcal{S}^1, \mathcal{S}^2\}$ \\
 \While{$\Psi \neq \emptyset$}
 {
 	Select a sub solution set $\mathcal{S}^t$ from $\Psi$ based on branching metric~\eqref{eq::branchingMetric}, where $t \gets \underset{u \in \Psi}{\arg \min} \quad \lambda_u$ \\
 	Derive $\mathcal{I}^t$ and $\mathcal{P}^t$ by $\mathcal{S}^t$~\eqref{eq::IframeSet}~\eqref{eq::PframeSet} \\
  	\eIf{$|\mathcal{I}^t|+|\mathcal{P}^t| = |V|$}
  	{
  		\If{$lb(\mathcal{S}^t) \leq ub(\mathcal{S}^*)$}
  		{
  			$ub(\mathcal{S}^*) \gets lb(\mathcal{S}^t)$ \\
  			$\mathcal{S}^* \gets \mathcal{S}^t$ \\
  		}
 	}
 	{	
 		\If{$lb(\mathcal{S}^t) \leq ub(\mathcal{S}^*)$}
 		{
 			Randomly select $k$ from $V \setminus \{\mathcal{I}^t \cup \mathcal{P}^t\}$ \\
 			Divide $\mathcal{S}^t$ into two sub solution sets by fixing $x_{kk} \gets 0$ and $x_{kk} \gets 1$, say $\mathcal{S}^{t_0}$ and $\mathcal{S}^{t_1}$ \\
 			Put the two divided sub solution sets into $\Psi$, i.e. $\Psi \gets \Psi \cup \{\mathcal{S}^{t_0}, \mathcal{S}^{t_1}\}$\\
 		}
 	}
 }
 \caption{\label{alg::bbAlgorithm}Branch-and-bound I-frame selection algorithm}
\end{algorithm}
\DecMargin{1em}
%
%
\begin{table*}[htb]
\footnotesize
\centering
\begin{tabular}{c c c}
  \hline
  Type &Notation &Description \\
  \hline
  \hline
  \multirow{8}{*}
  {Sets} &$D_i$ & Set of I-frame cameras that camera $i$ can overhear \\
  	&$\mathcal{S}$ & Whole solution set \\
  	&$\mathcal{S}^t$ & An arbitrary sub solution set \\
  	&$\mathcal{S}^{t_0}$ & Division of $\mathcal{S}^t$ by fixing one decision variable into $0$\\
  	&$\mathcal{S}^{t_1}$ & Division of $\mathcal{S}^t$ by fixing one decision variable into $1$\\
  	&$\mathcal{I}^t$ & I-frame cameras set of $\mathcal{S}^t$\\
  	&$\mathcal{P}^t$ & P-frame cameras set of $\mathcal{S}^t$\\
  	&$\Psi$ & Queue containing all sub solution sets\\
  \hline
  \multirow{1}{*}
  {Decision variables} &$x_{ii} \in \{0,1\}$ &Binary variable indicates if camera $i$ is encoded as an I-frame \\
  \hline
  \multirow{8}{*}
  {Parameters} &$\mathbf{H}$ & Initial cost matrix for amount of encoded bits\\
  	&$\mathbf{h}_k$ & The $k^{th}$ column of $\mathbf{H}$\\
  	&$\mathbf{H}^t$ & Modified cost matrix for $\mathcal{S}^t$\\
  	&$\tilde{\mathbf{X}^t}$ & Vector for partial determined decision variable at $\mathcal{S}^t$\\
  	&$\mathbf{R}^t$ & Vector for reference structure at $\mathcal{S}^t$\\
  	&$\Delta_i$ & Incremental cost for changing reference camera of camera $i$\\
  	&$\lambda_t$ & Branching metric for $\mathcal{S}^t$\\
  	&$\mathcal{S}^*$ & Optimal I-frame selection\\
  \hline
  \multirow{3}{*}
  {Functions} &$lb(\cdot)$ & Return the estimated lower bound\\
  	&$ub(\cdot)$ & Return the upper bound for objective value\\
  	&$Q(\cdot,\cdot)$ & Return which camera should change its reference camera\\
  \hline
\end{tabular}
\\
\caption{\label{tab::BBSymbols}Additional notations introduced in proposed BB algorithm}
\end{table*}
%
%
\subsubsection{Complexity Analysis}
{\color{red}Try to analyze the time complexity of BB algorithm. }
%